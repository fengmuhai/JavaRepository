TCP/IP协议
==================

1.TCP协议
------------------
TCP协议，全程Transport Control Protocol，传输控制协议。TCP是一种面向连接、可靠、全双工的、面向字节流的传输协议。在计算机OSI网络模型中，它完成第四层的传输层所指定的功能。用户数据报协议UDP，是同一层内另一个重要的传输协议


2.TCP/IP的四层协议系统
------------------

1）链路层：有时也称作数据链路层和网络接口层，通常包括操作系统中的设备驱动程序和计算机中对应的网络接口卡。

2）网络层：有时也称作互联网层，处理分组在网络中的活动。网络层包括IP协议（网络协议）、ICMP协议（互联网控制报文协议）、IGMP（Internet组管理协议）。

3）运输层：包含TCP（传输控制协议）和UDP（用户数据报协议）。TCP把数据分成小块，交给网络层，UDP则为应用层服务，把数据报的分组从一台主机发送到另一台主机，但并不能保证送到。

4）应用层：负责处理特定应用程序的细节，包括Tenet远程登录、FTP文件传输协议、SMTP简单邮件传送协议、SNMP简单网络管理协议。


3.TCP的三次握手和四次挥手
-----------------------
**1）TCP三次握手 建立连接**

**三次握手**：所谓三次握手(Three-way Handshake)，是指建立一个TCP连接时，需要客户端和服务器总共发送3个包。

**三次握手示意图**
![image](https://github.com/fengmuhai/JavaRepository/blob/master/tcp-ip/images/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.png)

**1.连接开始时，连接建立方Client发送了SYN包，并加上了序列号seq=a;  
2.服务器接收到SYN信息，发送SYN+ACK包，并加上了包序列号seq=b，确认号ack=a+1;  
3.客户端接收到SYN+ACK信息，发送ACK包，并加上包序列号seq=a+1，确认号ack=b+1;  **

1. 连接开始时，连接建立方(Client)发送SYN包，并包含了自己的初始序号a；

2. 连接接受方(Server)收到SYN包以后会回复一个SYN包，其中包含了对上一个a包的回应信息ACK，回应的序号为下一个希望收到包的序号，即a＋1，然后还包含了自己的初始序号b；

3. 连接建立方(Client)收到回应的SYN包以后，回复一个ACK包做响应，其中包含了下一个希望收到包的序号即b＋1。



**三次握手做了什么**：  
a）连接服务器指定端口，建立TCP连接；  
b）同步连接双发的序列号和确认号，并交换TCP窗口大小信息，以便后续通信的有序进行；  

**为什么是三次握手，而不是两次，四次？**  
我们知道**TCP是全双工的**。先说一下**全双工、单工、半双工**的概念。**半双工**是指A可以给B发消息，B也可以给A发消息，但不能同时发，即：A给B发消息的时候，B不能给A发消息；**单双工**是指A只能发给B，B不能发给A，或者反之；全双工是指A能发给B，而同一时间B也能发给A。

现在A和B通信，每次握手当作一次通信：  
第一次握手：A和B打电话说，你可以听到我说话么？  
第二次握手：B收到A的信息，回复A说，我可以听到你说话，你可以听到我说话么？  
第三次握手：A收到B信息，说：我可以听到，我要给你发信息了。  

**三次握手之后，A和B能确定的是，双发都能听到对方说话了，可以开始正常通信。**

**如果两次握手**，那么B回复A后，B不确定A是否能收到信息，如果B先说话，那么A可能后面的消息都接收不到，会出现问题；（**注意**：HTTP是基于TCP协议的，所以每次都是客户端发送请求，服务器应答，但是TCP还可以给其他应用层提供服务，即可能A、B在建立链接之后，谁都可能先开始通信。）

**如果是四次握手**，那么就造成了资源浪费，因为3次握手已经可以保证A和B进行正常通信。



